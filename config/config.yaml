bert_model:
  model_id: models/all-MiniLM-L12-v2
  threshold: 0.6
  use_cpu: true

semantic_cache:
  enabled: true
  backend_type: "memory" # Options: "memory" or "milvus"
  similarity_threshold: 0.8
  max_entries: 1000 # Only applies to memory backend
  ttl_seconds: 3600
  eviction_policy: "fifo"

tools:
  enabled: true
  top_k: 3
  similarity_threshold: 0.2
  tools_db_path: "config/tools_db.json"
  fallback_to_empty: true

prompt_guard:
  enabled: true
  use_modernbert: true
  model_id: "models/jailbreak_classifier_modernbert-base_model"
  threshold: 0.7
  use_cpu: true
  jailbreak_mapping_path: "models/jailbreak_classifier_modernbert-base_model/jailbreak_type_mapping.json"

# vLLM Endpoints Configuration
# IMPORTANT: 'address' field must be a valid IP address (IPv4 or IPv6)
# Supported formats: 127.0.0.1, 192.168.1.1, ::1, 2001:db8::1
# NOT supported: domain names (example.com), protocol prefixes (http://), paths (/api), ports in address (use 'port' field)
vllm_endpoints:
  - name: "endpoint1"
    address: "172.28.0.20" # Static IPv4 of llm-katan within docker compose network
    port: 8002
    weight: 1

model_config:
  "qwen3":
    reasoning_family: "qwen3" # This model uses Qwen-3 reasoning syntax
    preferred_endpoints: ["endpoint1"]
    pii_policy:
      allow_by_default: true

# Classifier configuration
classifier:
  category_model:
    model_id: "models/category_classifier_modernbert-base_model"
    use_modernbert: true
    threshold: 0.6
    use_cpu: true
    category_mapping_path: "models/category_classifier_modernbert-base_model/category_mapping.json"
  pii_model:
    model_id: "models/pii_classifier_modernbert-base_presidio_token_model"
    use_modernbert: true
    threshold: 0.7
    use_cpu: true
    pii_mapping_path: "models/pii_classifier_modernbert-base_presidio_token_model/pii_type_mapping.json"

# Categories with new use_reasoning field structure
categories:
  - name: business
    system_prompt: "You are a senior business consultant and strategic advisor with expertise in corporate strategy, operations management, financial analysis, marketing, and organizational development. Provide practical, actionable business advice backed by proven methodologies and industry best practices. Consider market dynamics, competitive landscape, and stakeholder interests in your recommendations."
    model_scores:
      - model: qwen3
        score: 0.7
        use_reasoning: false # Business performs better without reasoning
  - name: law
    system_prompt: "You are a knowledgeable legal expert with comprehensive understanding of legal principles, case law, statutory interpretation, and legal procedures across multiple jurisdictions. Provide accurate legal information and analysis while clearly stating that your responses are for informational purposes only and do not constitute legal advice. Always recommend consulting with qualified legal professionals for specific legal matters."
    model_scores:
      - model: qwen3
        score: 0.4
        use_reasoning: false
  - name: psychology
    system_prompt: "You are a psychology expert with deep knowledge of cognitive processes, behavioral patterns, mental health, developmental psychology, social psychology, and therapeutic approaches. Provide evidence-based insights grounded in psychological research and theory. When discussing mental health topics, emphasize the importance of professional consultation and avoid providing diagnostic or therapeutic advice."
    model_scores:
      - model: qwen3
        score: 0.6
        use_reasoning: false
  - name: biology
    system_prompt: "You are a biology expert with comprehensive knowledge spanning molecular biology, genetics, cell biology, ecology, evolution, anatomy, physiology, and biotechnology. Explain biological concepts with scientific accuracy, use appropriate terminology, and provide examples from current research. Connect biological principles to real-world applications and emphasize the interconnectedness of biological systems."
    model_scores:
      - model: qwen3
        score: 0.9
        use_reasoning: false
  - name: chemistry
    system_prompt: "You are a chemistry expert specializing in chemical reactions, molecular structures, and laboratory techniques. Provide detailed, step-by-step explanations."
    model_scores:
      - model: qwen3
        score: 0.6
        use_reasoning: true # Enable reasoning for complex chemistry
  - name: history
    system_prompt: "You are a historian with expertise across different time periods and cultures. Provide accurate historical context and analysis."
    model_scores:
      - model: qwen3
        score: 0.7
        use_reasoning: false
  - name: other
    system_prompt: "You are a helpful and knowledgeable assistant. Provide accurate, helpful responses across a wide range of topics."
    model_scores:
      - model: qwen3
        score: 0.7
        use_reasoning: false
  - name: health
    system_prompt: "You are a health and medical information expert with knowledge of anatomy, physiology, diseases, treatments, preventive care, nutrition, and wellness. Provide accurate, evidence-based health information while emphasizing that your responses are for educational purposes only and should never replace professional medical advice, diagnosis, or treatment. Always encourage users to consult healthcare professionals for medical concerns and emergencies."
    model_scores:
      - model: qwen3
        score: 0.5
        use_reasoning: false
  - name: economics
    system_prompt: "You are an economics expert with deep understanding of microeconomics, macroeconomics, econometrics, financial markets, monetary policy, fiscal policy, international trade, and economic theory. Analyze economic phenomena using established economic principles, provide data-driven insights, and explain complex economic concepts in accessible terms. Consider both theoretical frameworks and real-world applications in your responses."
    model_scores:
      - model: qwen3
        score: 1.0
        use_reasoning: false
  - name: math
    system_prompt: "You are a mathematics expert. Provide step-by-step solutions, show your work clearly, and explain mathematical concepts in an understandable way."
    model_scores:
      - model: qwen3
        score: 1.0
        use_reasoning: true # Enable reasoning for complex math
  - name: physics
    system_prompt: "You are a physics expert with deep understanding of physical laws and phenomena. Provide clear explanations with mathematical derivations when appropriate."
    model_scores:
      - model: qwen3
        score: 0.7
        use_reasoning: true # Enable reasoning for physics
  - name: computer science
    system_prompt: "You are a computer science expert with knowledge of algorithms, data structures, programming languages, and software engineering. Provide clear, practical solutions with code examples when helpful."
    model_scores:
      - model: qwen3
        score: 0.6
        use_reasoning: false
  - name: philosophy
    system_prompt: "You are a philosophy expert with comprehensive knowledge of philosophical traditions, ethical theories, logic, metaphysics, epistemology, political philosophy, and the history of philosophical thought. Engage with complex philosophical questions by presenting multiple perspectives, analyzing arguments rigorously, and encouraging critical thinking. Draw connections between philosophical concepts and contemporary issues while maintaining intellectual honesty about the complexity and ongoing nature of philosophical debates."
    model_scores:
      - model: qwen3
        score: 0.5
        use_reasoning: false
  - name: engineering
    system_prompt: "You are an engineering expert with knowledge across multiple engineering disciplines including mechanical, electrical, civil, chemical, software, and systems engineering. Apply engineering principles, design methodologies, and problem-solving approaches to provide practical solutions. Consider safety, efficiency, sustainability, and cost-effectiveness in your recommendations. Use technical precision while explaining concepts clearly, and emphasize the importance of proper engineering practices and standards."
    model_scores:
      - model: qwen3
        score: 0.7
        use_reasoning: false

default_model: "qwen3"

# Auto model name for automatic model selection (optional)
# This is the model name that clients should use to trigger automatic model selection
# If not specified, defaults to "MoM" (Mixture of Models)
# For backward compatibility, "auto" is always accepted as an alias
# Example: auto_model_name: "MoM"  # or any other name you prefer
# auto_model_name: "MoM"

# Include configured models in /v1/models list endpoint (optional, default: false)
# When false (default): only the auto model name is returned in the /v1/models endpoint
# When true: all models configured in model_config are also included in the /v1/models endpoint
# This is useful for clients that need to discover all available models
# Example: include_config_models_in_list: true
# include_config_models_in_list: false

# Reasoning family configurations
reasoning_families:
  deepseek:
    type: "chat_template_kwargs"
    parameter: "thinking"

  qwen3:
    type: "chat_template_kwargs"
    parameter: "enable_thinking"

  gpt-oss:
    type: "reasoning_effort"
    parameter: "reasoning_effort"
  gpt:
    type: "reasoning_effort"
    parameter: "reasoning_effort"

# Global default reasoning effort level
default_reasoning_effort: high

# API Configuration
api:
  batch_classification:
    max_batch_size: 100
    concurrency_threshold: 5
    max_concurrency: 8
    metrics:
      enabled: true
      detailed_goroutine_tracking: true
      high_resolution_timing: false
      sample_rate: 1.0
      duration_buckets:
        [0.001, 0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10, 30]
      size_buckets: [1, 2, 5, 10, 20, 50, 100, 200]

# Observability Configuration
observability:
  tracing:
    enabled: true # Enable distributed tracing for docker-compose stack
    provider: "opentelemetry" # Provider: opentelemetry, openinference, openllmetry
    exporter:
      type: "otlp" # Export spans to Jaeger (via OTLP gRPC)
      endpoint: "jaeger:4317" # Jaeger collector inside compose network
      insecure: true # Use insecure connection (no TLS)
    sampling:
      type: "always_on" # Sampling: always_on, always_off, probabilistic
      rate: 1.0 # Sampling rate for probabilistic (0.0-1.0)
    resource:
      service_name: "vllm-semantic-router"
      service_version: "v0.1.0"
      deployment_environment: "development"
