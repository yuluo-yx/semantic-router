bert_model:
  model_id: models/mom-embedding-light
  threshold: 0.6
  use_cpu: true

semantic_cache:
  enabled: true
  backend_type: "hybrid"  # Hybrid HNSW + Milvus backend
  similarity_threshold: 0.85
  ttl_seconds: 3600

  # Hybrid cache specific settings
  max_memory_entries: 100000  # Max entries in HNSW index (100K)

  # HNSW parameters
  hnsw_m: 16  # Number of bi-directional links
  hnsw_ef_construction: 200  # Construction quality parameter

  # Milvus configuration example
  milvus:
    # Milvus connection settings
    connection:
      # Milvus server host (change for production deployment)
      host: "localhost"  # For production: use your Milvus cluster endpoint
      # Milvus server port
      port: 19530  # Standard Milvus port
      # Database name (optional, defaults to "default")
      database: "semantic_router_cache"
      # Connection timeout in seconds
      timeout: 30
      # Authentication (enable for production)
      auth:
        enabled: false  # Set to true for production
        username: ""    # Your Milvus username
        password: ""    # Your Milvus password
      # TLS/SSL configuration (recommended for production)
      tls:
        enabled: false      # Set to true for secure connections
        cert_file: ""       # Path to client certificate
        key_file: ""        # Path to client private key
        ca_file: ""         # Path to CA certificate
    # Collection settings
    collection:
      # Name of the collection to store cache entries
      name: "semantic_cache"
      # Description of the collection
      description: "Semantic cache for LLM request-response pairs"
      # Vector field configuration
      vector_field:
        # Name of the vector field
        name: "embedding"
        # Dimension of the embeddings (auto-detected from model at runtime)
        dimension: 384  # This value is ignored - dimension is auto-detected from the embedding model
        # Metric type for similarity calculation
        metric_type: "IP"  # Inner Product (cosine similarity for normalized vectors)
      # Index configuration for the vector field
      index:
        # Index type (HNSW is recommended for most use cases)
        type: "HNSW"
        # Index parameters
        params:
          M: 16              # Number of bi-directional links for each node
          efConstruction: 64  # Search scope during index construction
    # Search configuration
    search:
      # Search parameters
      params:
        ef: 64  # Search scope during search (should be >= topk)
      # Number of top results to retrieve for similarity comparison
      topk: 10
      # Consistency level for search operations
      consistency_level: "Session"  # Options: Strong, Session, Bounded, Eventually
    # Performance and resource settings
    performance:
      # Connection pool settings
      connection_pool:
        # Maximum number of connections in the pool
        max_connections: 10
        # Maximum idle connections
        max_idle_connections: 5
        # Connection timeout for acquiring from pool
        acquire_timeout: 5
      # Batch operation settings
      batch:
        # Maximum batch size for insert operations
        insert_batch_size: 1000
        # Batch timeout in seconds
        timeout: 30
    # Data management
    data_management:
      # Automatic data expiration (TTL) settings
      ttl:
        # Enable automatic TTL-based cleanup (requires TTL to be set in main config)
        enabled: true
        # Field name to store timestamp for TTL calculation
        timestamp_field: "timestamp"
        # Cleanup interval in seconds (how often to run cleanup)
        cleanup_interval: 3600  # 1 hour
      # Compaction settings
      compaction:
        # Enable automatic compaction
        enabled: true
        # Compaction interval in seconds
        interval: 86400  # 24 hours
    # Logging and monitoring
    logging:
      # Log level for Milvus client operations (debug, info, warn, error)
      level: "info"
      # Enable query/search logging for debugging
      enable_query_log: false
      # Enable performance metrics collection
      enable_metrics: true
    # Development and debugging settings
    development:
      # Drop collection on startup (WARNING: This will delete all cached data)
      drop_collection_on_startup: true  # Enable for development to test dynamic dimensions
      # Create collection if it doesn't exist
      auto_create_collection: true
      # Print detailed error messages
      verbose_errors: true
  # (Deprecated) Or you can set up the milvus connection using the below config:
  # backend_config_path: "config/semantic-cache/milvus.yaml"

tools:
  enabled: true
  top_k: 3
  similarity_threshold: 0.2
  tools_db_path: "config/tools_db.json"
  fallback_to_empty: true

prompt_guard:
  enabled: true
  use_modernbert: false
  model_id: "models/mom-jailbreak-classifier"
  threshold: 0.7
  use_cpu: true
  jailbreak_mapping_path: "models/mom-jailbreak-classifier/jailbreak_type_mapping.json"

# vLLM Endpoints Configuration
vllm_endpoints:
  - name: "endpoint1"
    address: "172.28.0.20"
    port: 8002
    weight: 1

model_config:
  "qwen3":
    reasoning_family: "qwen3"
    preferred_endpoints: ["endpoint1"]

# Classifier configuration
classifier:
  enabled: true
  model_path: "models/qwen3-router_model/router_qwen_generative_model.safetensors"
  tokenizer_path: "models/qwen3-router_model"
  use_cpu: true
  threshold: 0.7

