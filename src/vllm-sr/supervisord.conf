[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:router]
command=/app/start-router.sh /app/config.yaml /app/.vllm-sr
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
redirect_stderr=false
autorestart=true
priority=1
environment=LD_LIBRARY_PATH="/usr/local/lib"

[program:envoy]
command=/bin/sh -c "python -m cli.config_generator /app/config.yaml /etc/envoy/envoy.yaml && /usr/local/bin/envoy -c /etc/envoy/envoy.yaml --log-level info --log-format '[%%Y-%%m-%%d %%T.%%e][%%l] %%v'"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
redirect_stderr=false
autorestart=true
priority=2
startsecs=5

[program:tail_access_logs]
command=/bin/sh -c "touch /var/log/envoy_access.log && tail -F /var/log/envoy_access.log 2>/dev/null || sleep infinity"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
redirect_stderr=false
autorestart=true
priority=3

[program:dashboard]
command=/app/start-dashboard.sh /app/config.yaml
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
redirect_stderr=false
autorestart=true
priority=4
startsecs=3

