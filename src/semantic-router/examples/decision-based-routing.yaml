# Example configuration demonstrating Decision-based routing with AND/OR rule combinations
# This is the new architecture that separates Categories (metadata) from Decisions (routing logic)

default_model: "general-model"

# Categories define domain metadata only (no routing logic)
categories:
  - name: "coding"
    description: "Programming and software development tasks"
    mmlu_categories:
      - "computer_science"
      - "programming"

  - name: "math"
    description: "Mathematical problems and calculations"
    mmlu_categories:
      - "mathematics"
      - "statistics"

  - name: "business"
    description: "Business and management topics"
    mmlu_categories:
      - "business"
      - "management"

# Keyword rules for fast pattern matching
keyword_rules:
  - category: "coding"
    operator: "OR"
    keywords:
      - "\\bcode\\b"
      - "\\bprogramming\\b"
      - "\\bfunction\\b"
      - "\\balgorithm\\b"
    case_sensitive: false

  - category: "math"
    operator: "OR"
    keywords:
      - "\\bcalculate\\b"
      - "\\bequation\\b"
      - "\\bsolve\\b"
    case_sensitive: false

# Embedding rules for semantic similarity matching
embedding_rules:
  - category: "coding"
    threshold: 0.75
    keywords:
      - "write a function"
      - "implement algorithm"
      - "debug code"
    aggregation_method: "mean"

# Decisions define routing logic with AND/OR rule combinations
# Strategy: "priority" (select highest priority) or "confidence" (select highest confidence)
strategy: "priority"

decisions:
  # Decision 1: Complex coding task requiring reasoning
  - name: "complex-coding"
    description: "Complex programming tasks that benefit from step-by-step reasoning"
    priority: 20
    rules:
      operator: "AND"  # All conditions must match
      conditions:
        - type: "keyword"
          name: "coding"
        - type: "domain"
          name: "coding"
    modelRefs:
      - model: "deepseek-coder"
        use_reasoning: true
        reasoning_effort: "high"
    plugins:
      - type: "header_mutation"
        configuration:
          add:
            - name: "X-Decision-Name"
              value: "complex-coding"
            - name: "X-Reasoning-Enabled"
              value: "true"
          update:
            - name: "User-Agent"
              value: "semantic-router/coding"
      - type: "semantic-cache"
        configuration:
          enabled: true
          similarity_threshold: 0.95

  # Decision 2: Simple coding task
  - name: "simple-coding"
    description: "Simple programming tasks"
    priority: 10
    rules:
      operator: "OR"  # Any condition matches
      conditions:
        - type: "keyword"
          name: "coding"
        - type: "embedding"
          name: "coding"
    modelRefs:
      - model: "codellama"
        use_reasoning: false

  # Decision 3: Math problems requiring reasoning
  - name: "math-reasoning"
    description: "Mathematical problems that benefit from reasoning"
    priority: 15
    rules:
      operator: "AND"
      conditions:
        - type: "keyword"
          name: "math"
        - type: "domain"
          name: "math"
    modelRefs:
      - model: "deepseek-math"
        use_reasoning: true
        reasoning_effort: "high"
    plugins:
      - type: "semantic-cache"
        configuration:
          enabled: true
          similarity_threshold: 0.95
      - type: "jailbreak"
        configuration:
          enabled: true
          threshold: 0.8

  # Decision 4: Business queries (no reasoning needed)
  - name: "business-query"
    description: "Business and management queries"
    priority: 10
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "business"
    modelRefs:
      - model: "general-model"
        use_reasoning: false
    plugins:
      - type: "semantic-cache"
        configuration:
          enabled: true
          similarity_threshold: 0.9

# Model configuration
model_config:
  "deepseek-coder":
    reasoning_family: "deepseek"
    preferred_endpoints: ["endpoint1"]

  "deepseek-math":
    reasoning_family: "deepseek"
    preferred_endpoints: ["endpoint1"]

  "codellama":
    preferred_endpoints: ["endpoint2"]

  "general-model":
    preferred_endpoints: ["endpoint1", "endpoint2"]

# vLLM endpoints
vllm_endpoints:
  - name: "endpoint1"
    address: "127.0.0.1"
    port: 8000
    weight: 1

  - name: "endpoint2"
    address: "127.0.0.1"
    port: 8001
    weight: 1

