FROM python:3.11-slim

# Set environment variables
ENV PIP_DISABLE_PIP_VERSION_CHECK=1 \
    PIP_NO_CACHE_DIR=1 \
    PYTHONUNBUFFERED=1

# Add OCI labels
LABEL org.opencontainers.image.source="https://github.com/vllm-project/semantic-router" \
      org.opencontainers.image.description="Lightweight model downloader for Semantic Router with huggingface_hub pre-installed"

WORKDIR /app

# Install minimal dependencies in a single layer
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        ca-certificates \
    && rm -rf /var/lib/apt/lists/* /var/cache/apt/archives/* \
    && pip install --no-cache-dir "huggingface_hub>=0.19.0" \
    && find /usr/local -type d -name '__pycache__' -exec rm -rf {} + 2>/dev/null || true \
    && find /usr/local -type f -name '*.pyc' -delete

# Set default entrypoint to bash to allow script execution from arguments
ENTRYPOINT ["/bin/bash", "-c"]
